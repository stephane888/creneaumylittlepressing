"use strict";(("undefined"!==typeof self?self:this)["webpackChunkcreneauxMylittlepressing"]=("undefined"!==typeof self?self:this)["webpackChunkcreneauxMylittlepressing"]||[]).push([[148],{5148:function(e,t,a){a.r(t),a.d(t,{default:function(){return je}});var s,i,r=function(){var e=this,t=e._self._c;return t("div",{staticClass:"creneaux-mbt"},[t("div",{staticClass:"container first-block",attrs:{currentCreneauType:e.currentCreneauType}},[t("div",{staticClass:"creneaux-mbt--block mt-5"},[t("app-title"),e.alert_message&&""!=e.alert_message?t("div",{staticClass:"alert alert-danger"},[e._v(" "+e._s(e.alert_message)+" ")]):e._e(),t("div",{staticClass:"block-left"},[t("tab-option")],1),t("div",{staticClass:"block-border"},[t("div",{staticClass:"row font-weight-bold type-livraison mb-2"},[t("inline-description")],1),t("div",{staticClass:"row d-flex justify-content-start commande-detail mb-5"},[t("div",{staticClass:"rectangle rond-left rond-right mx-3 mx-md-0 mb-3 mb-md-0 ml-md-5 mr-lg-5 pt-3 pl-3 pr-3 col-md-3"},[t("div",{staticClass:"h2 cursor-pointer"},[e._v("ADRESSE")]),t("div",{staticClass:"d-flex justify-content-between justify-content-md-start align-items-center"},[t("mapGoogle"),t("div",{staticClass:"icone-map"})],1)]),t("div",{staticClass:"col-md-7"},[t("div",{staticClass:"row ml-md-4 h-100"},[t("creneau",{attrs:{title:"Collecte",type:"collecte"}}),t("creneau",{attrs:{title:"Livraison",classes:"rond-right",type:"livraison"}})],1)])])])],1)])])},n=[],o=a(226),c={name:"AppTitle",computed:{...(0,o.rn)(["creneauConfigs"])},render(e){const t=e,a=this.creneauConfigs.title,s={class:{"text-left":!0,"font-weight-bold":!0}},i=[t("h1",s,a)];return t("div",i)}},l=c,d=a(1001),u=(0,d.Z)(l,s,i,!1,null,null,null),h=u.exports,p=function(){var e=this,t=e._self._c;return t("div",{staticClass:"col-12 width-100 d-flex flex-wrap mt-3 mb-3 font-weight-bold type-livraison",domProps:{innerHTML:e._s(e.activeTabOption)}})},y=[],_={name:"InlineDesc",computed:{...(0,o.Se)(["activeTabOption"])}},m=_,f=(0,d.Z)(m,p,y,!1,null,null,null),g=f.exports,v=function(){var e=this,t=e._self._c;return t("div",{staticClass:"first-row"},e._l(e.creneauType,(function(a,s){return t("div",{key:s,staticClass:"option btn",class:a.active?"option-badge":"",on:{click:function(t){return e.SelectTypeTab(s)}}},[t("div",{staticClass:"mx-auto h2 titre-tab"},[e._v(" "+e._s(a.titre)+" "),s>0?t("span",{staticClass:"small small-text d-block"},[e._v(" "+e._s(a.montant)+" ")]):e._e()])])})),0)},C=[],b={name:"SelectionHoraire",computed:{...(0,o.rn)(["creneauType"])},methods:{SelectTypeTab(e){this.$store.dispatch("SelectTypeTab",e)}}},D=b,w=(0,d.Z)(D,v,C,!1,null,null,null),M=w.exports,x=function(){var e=this,t=e._self._c;return t("div",[t("div",{staticClass:"h1 cursor-pointer"}),t("p",{staticClass:"cursor-pointer"}),e.location.city_on_map||e.location.locality?e._e():t("span",{staticClass:"btn option-badge mt-4 mb-3",on:{click:e.openPopupMap}},[e._v(" Ajouter une adresse ")]),""!==e.location.current_address?t("div",{staticClass:"h1 cursor-pointer",on:{click:e.openPopupMap}},[e._v(" "+e._s(e.location.locality)+" ")]):e._e(),""!==e.location.current_address?t("p",{staticClass:"cursor-pointer"},[e._v(" "+e._s(e.location.current_address)+" ")]):e._e(),t("AppPopUpMap",{ref:"apppopupmap",attrs:{"etape-checkout":!1,"action-after":!1},on:{update_location:e.update_location}})],1)},T=[],L=function(){var e=this,t=e._self._c;return t("div",[t("map-google",{ref:"mapgoogle",attrs:{configs:e.configs,"etape-checkout":e.etapeCheckout,"action-after":e.actionAfter},on:{update_location:e.update_location}})],1)},k=[],Y=a(7944),S=a(4029),P=function(){var e=this,t=e._self._c;return t("div",[t("section",{staticClass:"modal micromodal-slide",attrs:{id:"map-popup-wbu"}},[t("div",{staticClass:"modal__overlay"},[t("div",{staticClass:"modal__container",attrs:{role:"dialog","aria-modal":"true","aria-labelledby":"modal-1-title"}},[t("header",{staticClass:"modal__header"},[t("h2",{staticClass:"modal__title",attrs:{id:"modal-1-title"}},[e._v(" "+e._s(e.configs.titre_map.value)+" ")]),t("a",{staticClass:"modal__close",attrs:{href:"#",rel:"modal:close"},on:{click:function(t){return e.micromodal.close("map-popup-wbu")}}})]),t("main",{staticClass:"modal__content",attrs:{id:"modal-1-content"}},[t("div",{staticClass:"m-0 p-0 container-map"},[t("div",{attrs:{id:"map-display-wbu"}}),t("div",{staticClass:"text-over-lay"},[t("input",{directives:[{name:"model",rawName:"v-model",value:e.current_address,expression:"current_address"}],staticClass:"form-control",attrs:{id:"map-input-over",type:"text",placeholder:e.placeholder},domProps:{value:e.current_address},on:{input:function(t){t.target.composing||(e.current_address=t.target.value)}}})]),t("div",{staticClass:"center-marker"}),t("div",{staticClass:"address-confirm"},[t("button",{staticClass:"btn btn-lg bg-cl1",on:{click:e.save_localisation_cookie}},[e._v(" Confirmer l'adresse ")])])])])])])])])},H=[],A=(a(7658),a(2139)),Z={apiKey:"AIzaSyDurloZ0-xj8CNrQwkeSc53A-_n35Xji2Y",GoogleObejct:null,createGoogleObject(){const e=new A.a({apiKey:this.apiKey,version:"weekly",libraries:["places","geometry"]});return new Promise((t=>{e.load().then((e=>{this.GoogleObejct=e,t(e)})).catch((e=>{console.log("Erreur initialisation de la MAP : ",e)}))}))},extractPathForPolygon(e){const t=JSON.parse(e),a=[];if(t.features&&t.features[0]&&t.features[0].geometry&&t.features[0].geometry.coordinates)for(const s in t.features[0].geometry.coordinates[0]){const e=t.features[0].geometry.coordinates[0][s];a.push({lat:e[1],lng:e[0]})}return a},convertNewLineToArray(e,t="\n"){return e.split(t).map((e=>e.trim()))}},O=a(6818),E={name:"MapGoogle",props:{configs:{type:Object,required:!0},displayMarker:{type:Boolean,default:!0},image:{type:String,default:"/localisation/img/marker.png"},urlGood:{type:String,default:"/cart"},urlBad:{type:String,default:"/pages/map-error"},etapeCheckout:{type:Boolean,default:!0},actionAfter:{type:Boolean,default:!1}},data(){return{id_html:"map-google-field",villes:Z.convertNewLineToArray(this.configs.villes.value,";"),list_box:Z.convertNewLineToArray(this.configs.bps.value),micromodal:O.Z,map:null,lat:45.7941459,lon:4.68941940000002,point_in_polygon:!1,point_in_ville:!1,point_in_box:!1,titre_popup:"Merci de confirmer votre adresse",current_address:"",valide_text:"Commander maintenant",placeholder:"Entrez votre adresse"}},mounted(){this.point_in_box=!1,this.point_in_polygon=!1,this.point_in_ville=!1,this.createGoogleObject(),this.current_address=this.$store.state.location.current_address?this.$store.state.location.current_address:""},methods:{openPopupMap(){this.micromodal.show("map-popup-wbu")},closePopupMap(){this.micromodal.close("map-popup-wbu")},createGoogleObject(){Z.createGoogleObject().then((e=>{this.GoogleObejct=e,this.getPlace(),this.initMap(),this.geocoder=new this.GoogleObejct.maps.Geocoder}))},getPlace(){var e=this,t=document.querySelector("#map-input-over");this.options={componentRestrictions:{country:["fr"]},types:["address"],strictBounds:!0};const a=new this.GoogleObejct.maps.places.Autocomplete(t,this.options);this.GoogleObejct.maps.event.addListener(a,"place_changed",(function(){var t=a.getPlace();t&&t.formatted_address&&(e.current_address=t.formatted_address,e.city_on_map=t.vicinity,e.updateMap(t),e.openPopupMap())}))},initMap(){var e=this,t=this.lat,a=this.lon;this.map=new this.GoogleObejct.maps.Map(document.getElementById("map-display-wbu"),{center:new this.GoogleObejct.maps.LatLng(t,a),zoom:17,mapTypeId:this.GoogleObejct.maps.MapTypeId.ROADMAP,mapTypeControl:!1,scrollwheel:!1,mapTypeControlOptions:{style:this.GoogleObejct.maps.MapTypeControlStyle.HORIZONTAL_BAR},navigationControl:!1,panControl:!1,zoomControl:!0,streetViewControl:!1,fullscreenControl:!1,navigationControlOptions:{style:this.GoogleObejct.maps.NavigationControlStyle.ZOOM_PAN},styles:[{featureType:"poi",elementType:"labels.text.stroke",stylers:[{visibility:"off"}]},{featureType:"landscape.natural",elementType:"geometry",stylers:[{color:"#b8cb92"}]},{featureType:"landscape.man_made",elementType:"geometry",stylers:[{color:"#ece2d9"}]},{featureType:"road",elementType:"geometry",stylers:[{color:"#ffffff"}]},{featureType:"road.highway",elementType:"labels",stylers:[{visibility:"off"}]}]}),this.setMarker(),this.map.addListener("dragend",(function(){window.setTimeout((function(){var t=e.map.getCenter();t&&(e.lat=t.lat(),e.lon=t.lng(),e.city_on_map="",e.obtenir_address_proche())}),1e3)})),this.buildpolygon(),this.valide_selection()},updateMap:function(e){e.geometry&&(this.map.panTo(e.geometry.location),this.lat=e.geometry.location.lat(),this.lon=e.geometry.location.lng(),this.setMarker(),this.valide_selection())},valide_selection(){this.check_if_new_adress_in_polygon(),this.check_if_new_adress_in_villes(),this.check_if_new_adress_in_box()},obtenir_address_proche(){var e=this,t=new this.GoogleObejct.maps.LatLng(this.lat,this.lon);this.geocoder.geocode({location:t},(function(t,a){"OK"==a&&(e.current_address=t[0].formatted_address,e.updateMap(t[0]),e.getNameVilleFromPlace(t[0]))}))},setMarker(){if(!this.displayMarker)return!1;var e=this,t=this.lat,a=this.lon;this.marker=new this.GoogleObejct.maps.Marker({position:{lat:t,lng:a},map:e.map,icon:this.image})},save_localisation_cookie(){if(""==this.current_address)return this.$store.dispatch("setLocation",""),alert("Vous devez definir une adresse"),!1;if(this.point_in_polygon&&this.point_in_ville&&this.point_in_box){const e={current_address:this.current_address,city_on_map:this.city_on_map,locality:this.locality,route:this.route};this.$store.dispatch("setLocation",e),this.$emit("update_location",e),this.etapeCheckout?window.location.href=this.urlGood:(document.querySelector(".modal__close").click(),this.actionAfter&&document.querySelector(".button.cart-checkout-custom").click())}else this.$store.dispatch("setLocation",""),window.location.href=this.urlBad},buildpolygon(){this.polygon=new this.GoogleObejct.maps.Polygon({path:Z.extractPathForPolygon(this.configs.zone_valide.value),geodesic:!0,strokeColor:"#48a0d9",strokeOpacity:.5,strokeWeight:4,fillColor:"#48a0d9",fillOpacity:.15}),this.polygon.setMap(this.map)},check_if_new_adress_in_polygon(){var e=new this.GoogleObejct.maps.LatLng(this.lat,this.lon);this.GoogleObejct.maps.geometry.poly.containsLocation(e,this.polygon)?this.point_in_polygon=!0:this.point_in_polygon=!1},check_if_new_adress_in_villes(){const e=()=>{var e=!1;if(this.current_address&&this.current_address.length>0){var t=this.current_address.split(",");t[1].length>0&&this.villes.forEach((a=>{t[1].indexOf(a)>=0&&(e=!0)}))}return e};return"polygon_ville"!=this.type_limitation?(this.point_in_ville=!0,!1):this.villes.indexOf(this.city_on_map)>=0||e()?(this.point_in_ville=!0,!0):void(this.point_in_ville=!1)},check_if_new_adress_in_box(){const e=()=>{var e=!1;return this.current_address&&this.current_address.length>0&&this.current_address&&this.list_box.forEach((t=>{this.current_address.indexOf(t)>=0&&(e=!0)})),e};return"polygon_box"!=this.type_limitation?(this.point_in_box=!0,!1):e()?(this.point_in_box=!0,!0):(this.point_in_box=!1,!0)},getNameVilleFromPlace(e){var t="",a="";if(e.address_components){for(const i in e.address_components){var s=e.address_components[i];s.types&&s.types.includes("locality")&&""==a&&(a=s.long_name),s.types&&s.types.includes("route")&&""==t&&(t=s.long_name)}this.route=t,this.locality=a}}}},B=E,j=(0,d.Z)(B,P,H,!1,null,null,null),V=j.exports,I={name:"AppPopUpMap",store:Y.Z,components:{"map-google":V},props:{etapeCheckout:{type:Boolean,required:!0},actionAfter:{type:Boolean,required:!0}},computed:{...(0,S.rn)(["configs"])},methods:{openModal(){this.$refs.mapgoogle.openPopupMap()},update_location(e){this.$emit("update_location",e)}}},z=I,F=(0,d.Z)(z,L,k,!1,null,"e610e3a0",null),G=F.exports,q={name:"MapGoogle",components:{AppPopUpMap:G},computed:{...(0,o.rn)(["location"])},methods:{openPopupMap(){this.$refs.apppopupmap.openModal()},update_location(e){console.log(" update_location : ",e),this.$store.dispatch("setLocation",e)}}},N=q,$=(0,d.Z)(N,x,T,!1,null,null,null),R=$.exports,W=function(){var e=this,t=e._self._c;return t("div",{staticClass:"rectangle mx-2 mx-md-0 mb-3 mb-md-0 mx-3 pt-4 pl-sm-3 col-md-6",class:e.classes},[t("div",{staticClass:"title-creneau h2"},[e._v(e._s(e.title))]),t("div",{staticClass:"d-flex justify-content-between justify-content-md-start line-creneau h1"},[t("hours",{attrs:{type:e.type},on:{selectNextDay:e.selectNextDay}}),t("i",{staticClass:"icone-svg mb-md-1 mb-lg-2 cursor-pointer",on:{click:function(t){e.showCalandar=!e.showCalandar}}},[t("SvgCalandar")],1)],1),t("p",{staticClass:"cursor-pointer",on:{click:function(t){e.showCalandar=!e.showCalandar}}},[e._v(" "+e._s(e.appDateDisplay)+" ")]),e.showCalandar?t("div",{staticClass:"over-container-date",on:{click:function(t){e.showCalandar=!e.showCalandar}}}):e._e(),t("calendar",{ref:"calendar",attrs:{"show-calandar":e.showCalandar,type:e.type}})],1)},U=[],J=function(){var e=this,t=e._self._c;return t("div",{staticStyle:{width:"100%"},attrs:{triggerBuilder:e.triggerBuilder,TriggerAfterHourBuild:e.TriggerAfterHourBuild}},[t("advanced-select",{attrs:{disabled:e.disabled_creneau,options:e.list_creneaux,"show-labels":!1,searchable:!1,placeholder:"00:00 - 00:00","track-by":"begin","open-direction":"bottom"},scopedSlots:e._u([{key:"singleLabel",fn:function({option:t}){return[e._v(" "+e._s(t.begin)+" - "+e._s(t.end)+" ")]}},{key:"option",fn:function(a){return[t("span",{attrs:{checkstatus:a.option.checkstatus}},[e._v(" "+e._s(a.option.begin)+" - "+e._s(a.option.end)+" ")])]}}]),model:{value:e.current_creneau,callback:function(t){e.current_creneau=t},expression:"current_creneau"}},[t("template",{slot:"noOptions"},[t("span",[e._v(" Aucun créneau disponible à cette date ")])])],2)],1)},K=[],Q=a(3830),X=a.n(Q),ee=a(77),te=a(7514),ae=a(5249),se=a.n(ae);class ie{constructor(e,t,a,s,i,r="days"){if(this.dateMonth=e,this.IndexDayDisabled=[],this.DaysDisabledDate=[],this.DaysDisabledPeriode=[],this.location=te.Z.state.location,a.days&&this.setDaysDisabled(a.days),this.type=t,this.currentCreneauType=s,i.length)for(const n in i){const e=i[n];e.type_disabled===r&&(this.setDaysDisabledDate(e.date_desactivee,e.pobox),this.setDaysDisabledPeriode(e.periode_desactivee,e.pobox))}}setDaysDisabled(e){e.forEach((e=>{e.value||this.IndexDayDisabled.push(e.indice)}))}setDaysDisabledDate(e,t){let a=!1;this.location.current_address&&t.forEach((e=>{this.location.current_address.includes(e.value)&&(a=!0)})),(0===t.length||a)&&e.forEach((e=>{this.DaysDisabledDate.push(e.date)}))}setDaysDisabledPeriode(e,t){let a=!1;this.location.current_address&&t.forEach((e=>{this.location.current_address.includes(e.value)&&(a=!0)})),(0===t.length||a)&&e.forEach((e=>{""!==e.debut&&""!==e.fin&&this.DaysDisabledPeriode.push(e)}))}ValidationDay(e){return new Promise((t=>{if(e.diff(this.dateMonth,"minute")>=0)if(this.IndexDayDisabled.includes(e.day()))t(this.statusDate(e,!1,"default-disable-day"));else if(this.DaysDisabledDate.includes(e.format("YYYY-MM-DD")))t(this.statusDate(e,!1,"default-disable-date"));else if(this.DaysDisabledPeriode.length)for(const a in this.DaysDisabledPeriode){const s=this.DaysDisabledPeriode[a],i=e.diff(se()(s.debut,"YYYY-MM-DD"),"minute"),r=e.diff(se()(s.fin,"YYYY-MM-DD"),"minute");if(i>=0&&r<=0){t(this.statusDate(e,!1,"default-disable-periode"));break}const n=parseInt(a)+1;n===this.DaysDisabledPeriode.length&&t(this.statusDate(e,!0,"default-actif-periode"))}else t(this.statusDate(e,!0,"default-actif-date"));else t(this.statusDate(e,!1,"default-disable"))}))}disabledByCodePostal(){console.log("store : ",te.Z.state.location)}statusDate(e,t,a,s=!1){return{status:t,custom_class:a,date:e.date(),select:s,date_string:e.format("YYYY-MM-DD")}}}var re=ie;class ne{constructor(e,t,a,s=[]){this.type=t,this.date=e,this.filterHours=[],this.creneauFilters=a,this.CreneauxExterne=s}getPlageDate(e){if(this.dateBegin=this.date,""!=e.h_debut&&""!=e.h_fin){const t=e.h_debut.split(":"),a=e.h_fin.split(":");t[1]&&a[1]&&this.filterHours.push({Filter:e,dateBegin:se()(this.date).set({hour:t[0],minute:t[1],second:0}),dateEnd:se()(this.date).set({hour:a[0],minute:a[1],second:0})})}}async rebuildFilter(){for(const e in this.creneauFilters){const t=this.creneauFilters[e];if("hours"===t.type_disabled&&""!=t.h_debut&&""!=t.h_fin){const e=new re(this.date,this.type,[],[],[t],"hours"),a=await e.ValidationDay(this.date),s=t.h_debut.split(":"),i=t.h_fin.split(":");s[1]&&i[1]&&this.filterHours.push({...t,dayValid:a.status,dateBegin:se()(this.date).set({hour:s[0],minute:s[1],second:0}),dateEnd:se()(this.date).set({hour:i[0],minute:i[1],second:0})})}}}async checkIsDisabled(e,t){return new Promise((a=>{const s=e.format("HH:mm")+" - "+t.format("HH:mm");this.CreneauxExterne.includes(s)&&a(!0),0===this.filterHours.length&&a(!1);const i=a=>{const s=e.diff(a.dateBegin,"minute"),i=e.diff(a.dateEnd,"minute"),r=t.diff(a.dateBegin,"minute"),n=t.diff(a.dateEnd,"minute");return s>=0&&i<0||r>0&&n<=0||i<0&&n>0};for(const e in this.filterHours){const t=this.filterHours[e];if(t.jours_select.length){if(t.jours_select.includes(this.date.day())&&i(t)&&!t.dayValid){a(!0);break}}else if(i(t)&&!t.dayValid){a(!0);break}const s=parseInt(e)+1;this.filterHours.length===s&&a(!1)}}))}}var oe=ne;class ce{constructor(e,t,a,s,i){this.date=e,this.creneauFilters=t,this.creneauConfigs=a,this.currentCreneauType=s,this.list_creneaux=[],this.type=i}getCurrentBandHour(){const e=this.creneauConfigs;return new Promise((t=>{if(e.days)for(const a in e.days){const s=e.days[a];s.indice===this.date.day()&&t(s)}}))}async buildHour(e=[]){const t=new oe(this.date,this.type,this.creneauFilters,e);await t.rebuildFilter();const a=await this.getCurrentBandHour(),s=a.debut.split(":"),i=a.fin.split(":"),r=se()(this.date).set({hour:s[0],minute:s[1],second:0}),n=se()(this.date).set({hour:i[0],minute:i[1],second:0});return new Promise((e=>{const a=()=>{const s=se()(r).add(this.currentCreneauType.creneau,"minute");s.diff(n)<=0?t.checkIsDisabled(r,s).then((e=>{const t={begin:r.format("HH:mm"),end:s.format("HH:mm"),$isDisabled:e,checkstatus:""};r.diff(this.date)>0&&!e&&this.list_creneaux.push(t),r.add(this.currentCreneauType.delai_next_creneau,"minute"),a()})):e(!0)};a()}))}}var le=ce,de=a(8683),ue={name:"HoursComponent",components:{AdvancedSelect:X()},props:{type:{type:String,required:!0}},data(){return{current_creneau:"",disabled_creneau:!1,list_creneaux:[]}},computed:{...(0,o.Se)(["appDate"]),...(0,o.rn)(["activeType","creneauConfigs","creneauFilters","creneauType","creneauCollecte","creneauLivraison","CreneauxExterne"]),WatchDateSelect(){if(this.appDate){if(this.type===ee.Z.crex1.id){const e=se()(this.creneauCollecte.date_string,"YYYY-MM-DD");return this.appDate.format("YYYY-MM-DD")==this.creneauCollecte.date_string&&e.set(this.getHours),e}if(this.type===ee.Z.crex2.id){const e=se()(this.creneauLivraison.date_string,"YYYY-MM-DD").set(this.getHours);return e}}return null},getHours(){return this.type===ee.Z.crex1.id?{hour:this.appDate.hour(),minute:this.appDate.minute()+parseInt(this.creneauConfigs.deccalage_creneau_depart),second:this.appDate.second()}:this.type===ee.Z.crex2.id&&this.creneauCollecte.date?{hour:this.creneauCollecte.date.hour(),minute:this.creneauCollecte.date.minute(),second:this.creneauCollecte.date.second()}:null},currentCreneauType(){return this.creneauType[this.activeType]},getCurrentBandHour(){if(this.creneauConfigs.days&&this.WatchDateSelect&&this.WatchDateSelect._isValid)for(const e in this.creneauConfigs.days){const t=this.creneauConfigs.days[e];if(t.indice===this.WatchDateSelect.day())return t}return null},triggerBuilder(){return this.getCurrentBandHour?(this.emptyValue(),this.buildHours(),this.getCurrentBandHour):null},TriggerAfterHourBuild(){return this.list_creneaux.length?(this.selectFirtCreneau(),this.list_creneaux):null}},watch:{current_creneau(e){this.$store.dispatch("SetSelectHour",this.BuildPayload(e))}},methods:{selectFirtCreneau(){this.current_creneau=this.list_creneaux[0]},emptyValue(){this.current_creneau=!1,this.list_creneaux=[]},BuildPayload(e){if(!e)return{type:this.type,hour:e,date:e};const t=e.begin.split(":");return{type:this.type,hour:e,date:se()(this.WatchDateSelect).set({hour:t[0],minute:t[1],secodne:0})}},buildHours(){const e=new le(this.WatchDateSelect,this.creneauFilters,this.creneauConfigs,this.currentCreneauType,this.type),t={month:this.WatchDateSelect.format("YYYY-MM-DD"),shop:de.EC.isLocalDev?"my-little-pressing.myshopify.com":window.ShopId,nombre_creneau:this.creneauConfigs.nombre_res_creneau,type:this.type};ee.Z.LoadCreneauxExterne(t).then((t=>{console.log(" LoadCreneauxExterne ",this.type," : ",t),e.buildHour(t).then((()=>{this.list_creneaux=e.list_creneaux}))}))}}},he=ue,pe=(0,d.Z)(he,J,K,!1,null,null,null),ye=pe.exports,_e=function(){var e=this,t=e._self._c;return t("div",{directives:[{name:"show",rawName:"v-show",value:e.showCalandar,expression:"showCalandar"}],staticClass:"container-date flat cercle",attrs:{initCreneau:e.initCreneau,ReInitCreneauLivraison:e.ReInitCreneauLivraison,updateCurrentDateSelect:e.updateCurrentDateSelect}},[t("div",{staticClass:"single-date-picker__calendar-month-header"},[t("div",{staticClass:"single-date-picker__arrow left",on:{click:e.previowMonth}}),""!=e.calandarTitle?t("div",{staticClass:"single-date-picker__year",domProps:{innerHTML:e._s(e.calandarTitle)}}):e._e(),t("div",{staticClass:"single-date-picker__arrow right",on:{click:e.nextMonth}})]),t("ul",{staticClass:"d-flex flex-wrap justify-content-center"},[e.showDayLabel?t("div",{staticClass:"d-flex flex-wrap justify-content-center w-100"},[t("li",{staticClass:"date day"},[e._v("Lun")]),t("li",{staticClass:"date day"},[e._v("Mar")]),t("li",{staticClass:"date day"},[e._v("Mer")]),t("li",{staticClass:"date day"},[e._v("Jeu")]),t("li",{staticClass:"date day"},[e._v("Ven")]),t("li",{staticClass:"date day"},[e._v("Sam")]),t("li",{staticClass:"date day"},[e._v("Dim")])]):e._e(),e._l(e.listCalanderDays,(function(a,s){return t("li",{key:s,class:["date",a.status?"actif":"disable",a.custom_class,a.select?"selected":""],on:{click:function(t){return e.selectDate(a)}}},[t("span",{domProps:{innerHTML:e._s(a.date)}})])}))],2)])},me=[];class fe{constructor(e,t,a,s,i,r){this.currentDate=se()(e),this.currentMonth=this.currentDate.month(),this.currentYear=this.currentDate.year(),this.dates=[],this.dateMonth=se()(t).set({hour:0,minute:0,second:0}),this.creneauConfigs=s,this.currentCreneauType=i,this.creneauFilters=r,this.type=a,this.CountDecallageAppliquer=0,this.currentCreneauType.delai=parseInt(this.currentCreneauType.delai)}buildDaysOfMonth(){const e=6,t=se()().set({year:this.currentYear,month:this.currentMonth,date:1,hour:0,minute:0,second:0});let a=t.day();a||(a=7),t.add(-a,"day"),a--;const s=32-se()().set({year:this.currentYear,month:this.currentMonth,date:32,hour:0,minute:0,second:0}).date(),i=se()().set({year:this.currentYear,month:this.currentMonth,date:s,hour:0,minute:0,second:0});let r=1;for(let n=0;n<e;n++){if(r>s)break;for(let e=0;e<7;e++){const o=new re(this.dateMonth,this.type,this.creneauConfigs,this.currentCreneauType,this.creneauFilters);if(0===n&&e<a){const e=t.add(1,"day");o.ValidationDay(e).then((e=>{this.dates.push(this.DisabledBydelai(e))}))}else if(r>s){const e=i.add(1,"day");o.ValidationDay(e).then((e=>{this.dates.push(this.DisabledBydelai(e))}))}else{const e=t.add(1,"day");o.ValidationDay(e).then((e=>{this.dates.push(this.DisabledBydelai(e))})),r++}}}}DisabledBydelai(e){return"livraison"===this.type&&this.CountDecallageAppliquer<this.currentCreneauType.delai&&e.status&&(this.CountDecallageAppliquer++,e.status=!1,e.custom_class="default-disable-delai"),e}}var ge=fe,ve={name:"CalendarComponent",props:{showCalandar:{type:Boolean,default:!1},type:{type:String,required:!0}},data(){return{listCalanderDays:[],calendarNav:0,calandarTitle:"",showMonthInDate:!1,showDayLabel:!0,dateSelect:null}},computed:{...(0,o.Se)(["appDate"]),...(0,o.rn)(["activeType","creneauConfigs","creneauFilters","creneauType","creneauCollecte","creneauLivraison"]),initCreneau(){if(console.log("initCreneau : ",this.type),this.type===ee.Z.crex1.id){if(this.appDate)return this.buildCalendar(),this.appDate}else if(this.type===ee.Z.crex2.id&&this.creneauCollecte.date_string)return this.buildCalendar(),this.creneauCollecte.date_string;return null},ReInitCreneauLivraison(){return this.creneauCollecte.date_string&&this.currentCreneauType&&this.type===ee.Z.crex2.id&&this.emptyCurentDateSelect(),this.creneauCollecte.date_string},updateCurrentDateSelect(){return this.listCalanderDays.length?(this.type==ee.Z.crex1.id&&(this.creneauCollecte.date_string?this.selectEgalActiveDate():this.selectFirstActiveDate()),this.type==ee.Z.crex2.id&&(this.creneauLivraison.date_string?this.selectEgalActiveDate():this.selectFirstActiveDate()),this.listCalanderDays.length):null},currentCreneauType(){return this.creneauType[this.activeType]}},methods:{emptyCurentDateSelect(){this.$store.dispatch("SetSelectDate",this.BuildPayload(!1)),this.calendarNav=0},BuildPayload(e){return{type:this.type,date_string:e}},selectFirstActiveDate(){for(const e in this.listCalanderDays){const t=this.listCalanderDays[e];if(t.status){t.select=!0,this.$store.dispatch("SetSelectDate",this.BuildPayload(t.date_string));break}const a=parseInt(e)+1;this.listCalanderDays.length===a&&this.nextMonth()}},selectSpecifiqDateActive(e=1){let t=0;for(const a in this.listCalanderDays){const s=this.listCalanderDays[a];if(s.status){if(t==e&&t<5){s.select=!0,this.$store.dispatch("SetSelectDate",this.BuildPayload(s.date_string));break}s.select=!1,s.status=!1,t++}const i=parseInt(a)+1;this.listCalanderDays.length===i&&this.nextMonth()}},selectEgalActiveDate(){for(const e in this.listCalanderDays){const t=this.listCalanderDays[e];if(this.type===ee.Z.crex1.id&&t.date_string===this.creneauCollecte.date_string){t.status?t.select=!0:this.selectFirstActiveDate();break}if(this.type===ee.Z.crex2.id&&t.date_string===this.creneauLivraison.date_string){t.status?t.select=!0:this.selectFirstActiveDate();break}const a=parseInt(e)+1;this.listCalanderDays.length==a&&(this.type,ee.Z.crex2.id)}},selectDate(e){if(!e.status)return!1;this.listCalanderDays.forEach((e=>{e.select=!1})),e.select=!0,this.$store.dispatch("SetSelectDate",this.BuildPayload(e.date_string))},previowMonth(){this.calendarNav--},nextMonth(){this.calendarNav++},buildCalendar(){let e,t;this.type===ee.Z.crex1.id?(e=se()(this.appDate).add(this.calendarNav,"month"),t=this.appDate):(e=se()(this.creneauCollecte.date_string,"YYYY-MM-DD").add(this.calendarNav,"month"),t=se()(this.creneauCollecte.date_string,"YYYY-MM-DD"));const a=new ge(e,t,this.type,this.creneauConfigs,this.currentCreneauType,this.creneauFilters);a.buildDaysOfMonth(),this.listCalanderDays=a.dates,this.calandarTitle=se()(e).locale("fr").format("MMMM  YYYY")}}},Ce=ve,be=(0,d.Z)(Ce,_e,me,!1,null,null,null),De=be.exports,we=function(){var e=this,t=e._self._c;return t("svg",{staticStyle:{"enable-background":"new 0 0 122.88 122.88"},attrs:{id:"Layer_1",version:"1.1",xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",x:"0px",y:"0px",viewBox:"0 0 122.88 122.88","xml:space":"preserve"}},[t("g",[t("path",{attrs:{d:"M81.61,4.73c0-2.61,2.58-4.73,5.77-4.73c3.19,0,5.77,2.12,5.77,4.73v20.72c0,2.61-2.58,4.73-5.77,4.73 c-3.19,0-5.77-2.12-5.77-4.73V4.73L81.61,4.73z M66.11,103.81c-0.34,0-0.61-1.43-0.61-3.2c0-1.77,0.27-3.2,0.61-3.2H81.9 c0.34,0,0.61,1.43,0.61,3.2c0,1.77-0.27,3.2-0.61,3.2H66.11L66.11,103.81z M15.85,67.09c-0.34,0-0.61-1.43-0.61-3.2 c0-1.77,0.27-3.2,0.61-3.2h15.79c0.34,0,0.61,1.43,0.61,3.2c0,1.77-0.27,3.2-0.61,3.2H15.85L15.85,67.09z M40.98,67.09 c-0.34,0-0.61-1.43-0.61-3.2c0-1.77,0.27-3.2,0.61-3.2h15.79c0.34,0,0.61,1.43,0.61,3.2c0,1.77-0.27,3.2-0.61,3.2H40.98 L40.98,67.09z M66.11,67.09c-0.34,0-0.61-1.43-0.61-3.2c0-1.77,0.27-3.2,0.61-3.2H81.9c0.34,0,0.61,1.43,0.61,3.2 c0,1.77-0.27,3.2-0.61,3.2H66.11L66.11,67.09z M91.25,67.09c-0.34,0-0.61-1.43-0.61-3.2c0-1.77,0.27-3.2,0.61-3.2h15.79 c0.34,0,0.61,1.43,0.61,3.2c0,1.77-0.27,3.2-0.61,3.2H91.25L91.25,67.09z M15.85,85.45c-0.34,0-0.61-1.43-0.61-3.2 c0-1.77,0.27-3.2,0.61-3.2h15.79c0.34,0,0.61,1.43,0.61,3.2c0,1.77-0.27,3.2-0.61,3.2H15.85L15.85,85.45z M40.98,85.45 c-0.34,0-0.61-1.43-0.61-3.2c0-1.77,0.27-3.2,0.61-3.2h15.79c0.34,0,0.61,1.43,0.61,3.2c0,1.77-0.27,3.2-0.61,3.2H40.98 L40.98,85.45z M66.11,85.45c-0.34,0-0.61-1.43-0.61-3.2c0-1.77,0.27-3.2,0.61-3.2H81.9c0.34,0,0.61,1.43,0.61,3.2 c0,1.77-0.27,3.2-0.61,3.2H66.11L66.11,85.45z M91.25,85.45c-0.34,0-0.61-1.43-0.61-3.2c0-1.77,0.27-3.2,0.61-3.2h15.79 c0.34,0,0.61,1.43,0.61,3.2c0,1.77-0.27,3.2-0.61,3.2H91.25L91.25,85.45z M15.85,103.81c-0.34,0-0.61-1.43-0.61-3.2 c0-1.77,0.27-3.2,0.61-3.2h15.79c0.34,0,0.61,1.43,0.61,3.2c0,1.77-0.27,3.2-0.61,3.2H15.85L15.85,103.81z M40.98,103.81 c-0.34,0-0.61-1.43-0.61-3.2c0-1.77,0.27-3.2,0.61-3.2h15.79c0.34,0,0.61,1.43,0.61,3.2c0,1.77-0.27,3.2-0.61,3.2H40.98 L40.98,103.81z M29.61,4.73c0-2.61,2.58-4.73,5.77-4.73s5.77,2.12,5.77,4.73v20.72c0,2.61-2.58,4.73-5.77,4.73 s-5.77-2.12-5.77-4.73V4.73L29.61,4.73z M6.4,45.32h110.07V21.47c0-0.8-0.33-1.53-0.86-2.07c-0.53-0.53-1.26-0.86-2.07-0.86H103 c-1.77,0-3.2-1.43-3.2-3.2c0-1.77,1.43-3.2,3.2-3.2h10.55c2.57,0,4.9,1.05,6.59,2.74c1.69,1.69,2.74,4.02,2.74,6.59v27.06v65.03 c0,2.57-1.05,4.9-2.74,6.59c-1.69,1.69-4.02,2.74-6.59,2.74H9.33c-2.57,0-4.9-1.05-6.59-2.74C1.05,118.45,0,116.12,0,113.55V48.52 V21.47c0-2.57,1.05-4.9,2.74-6.59c1.69-1.69,4.02-2.74,6.59-2.74H20.6c1.77,0,3.2,1.43,3.2,3.2c0,1.77-1.43,3.2-3.2,3.2H9.33 c-0.8,0-1.53,0.33-2.07,0.86c-0.53,0.53-0.86,1.26-0.86,2.07V45.32L6.4,45.32z M116.48,51.73H6.4v61.82c0,0.8,0.33,1.53,0.86,2.07 c0.53,0.53,1.26,0.86,2.07,0.86h104.22c0.8,0,1.53-0.33,2.07-0.86c0.53-0.53,0.86-1.26,0.86-2.07V51.73L116.48,51.73z M50.43,18.54 c-1.77,0-3.2-1.43-3.2-3.2c0-1.77,1.43-3.2,3.2-3.2h21.49c1.77,0,3.2,1.43,3.2,3.2c0,1.77-1.43,3.2-3.2,3.2H50.43L50.43,18.54z"}})])])},Me=[],xe={name:"SvgCalandar"},Te=xe,Le=(0,d.Z)(Te,we,Me,!1,null,null,null),ke=Le.exports,Ye={name:"CreneauComponent",components:{hours:ye,calendar:De,SvgCalandar:ke},props:{title:{type:String,required:!0},classes:{type:String,default:"rond-left"},type:{type:String,required:!0}},data(){return{showCalandar:!1}},computed:{...(0,o.rn)(["creneauCollecte","creneauLivraison","creneauConfigs"]),appDateDisplay:{get(){return"livraison"===this.type&&this.creneauLivraison.date_string?se()(this.creneauLivraison.date_string,"YYYY-MM-DD").locale("fr").format("dddd Do MMMM"):"collecte"===this.type&&this.creneauCollecte.date_string?se()(this.creneauCollecte.date_string,"YYYY-MM-DD").locale("fr").format("dddd Do MMMM"):""}}},methods:{selectNextDay(){this.$refs.calendar.selectSpecifiqDateActive()}}},Se=Ye,Pe=(0,d.Z)(Se,W,U,!1,null,null,null),He=Pe.exports,Ae={show_cover:!1,cart:null,creneauTypes:te.Z.state.creneauType,creneauConfigs:te.Z.state.creneauConfigs,CartTypeLivraison:"",TypeLivraison:{},show_alert:!1,creneauCollecte:te.Z.state.creneauCollecte,creneauLivraison:te.Z.state.creneauLivraison,location:te.Z.state.location,alert_attribut_class:"alert-primary",ShopifyFormatMoney(e,t){let a="";const s=/\{\{\s*(\w+)\s*\}\}/,i=t||this.money_format;function r(e,t){return"undefined"===typeof e?t:e}function n(e,t,a,s){if(t=r(t,2),a=r(a,","),s=r(s,"."),isNaN(e)||null==e)return 0;e=(e/100).toFixed(t);const i=e.split("."),n=i[0].replace(/(\d)(?=(\d\d\d)+(?!\d))/g,"$1"+a),o=i[1]?s+i[1]:"";return n+o}switch("string"===typeof e&&(e=e.replace(".","")),i.match(s)[1]){case"amount":a=n(e,2);break;case"amount_no_decimals":a=n(e,0);break;case"amount_with_comma_separator":a=n(e,2,".",",");break;case"amount_no_decimals_with_comma_separator":a=n(e,0,".",",");break}return i.replace(s,a)},addProduct:function(e,t=1){return this.show_cover=!0,new Promise(((a,s)=>{this.show_cover=!0,de.EC.post("/cart/add",{id:e,quantity:t}).then((e=>{this.show_cover=!1,a(e)})).catch((()=>{this.show_cover=!1,s(!1)}))}))},async verification(){te.Z.state.alert_message="",this.show_alert=!1;const e=await this.VerificationCrenaux(),t=await this.VerificationAddress(),a=await this.ValidationMontant();return!!(e&&t&&a)||(this.show_alert=!0,this.alert_attribut_class="alert-danger ml-md-4",!1)},async VerificationCrenaux(){let e=!0,t=!0;return this.creneauCollecte.date&&this.creneauCollecte.hour||(t=!1,te.Z.state.alert_message+="- Vous devez selectionner un creneau pour la collecte.<br />"),this.creneauLivraison.date&&this.creneauLivraison.date||(e=!1,te.Z.state.alert_message+="- Vous devez selectionner un creneau pour la livraison.<br />"),!(!e||!t)},async VerificationAddress(){return!!this.location.current_address||(te.Z.state.alert_message+=" - Vous devez selectionner une adresse. <br /> ",!1)},async ValidationMontant(){const e=10*parseFloat(this.creneauConfigs.montant_min),t=e=>{const t=/\{\{(.*?)\}\}/g;let a,s=0;while(null!==(a=t.exec(e))&&s<10){s++;const t=a[1].trim(" ");e=e.replace(a[0],void 0!==this.creneauConfigs[t]?this.creneauConfigs[t]:"...")}return e};return!(e>=this.cart.total_price)||(te.Z.state.alert_message+=t(this.creneauConfigs.text_alert_montant_min),!1)},async buildAttribut(){let e="Livraison";e+="\r\n",e+="Date :"+this.creneauLivraison.date.format("DD-MM-YYYY HH:mm:ss"),e+="\r\n",e+="Creneau :"+this.creneauLivraison.hour.begin+" - "+this.creneauLivraison.hour.end;let t="Collecte";t+="\r\n",t+="Date :"+this.creneauCollecte.date.format("DD-MM-YYYY HH:mm:ss"),t+="\r\n",t+="Creneau :"+this.creneauCollecte.hour.begin+" - "+this.creneauCollecte.hour.end;const a=this.creneauCollecte.date.format("DD-MM-YYYY"),s=this.creneauCollecte.hour.begin+" - "+this.creneauCollecte.hour.end,i=this.creneauLivraison.date.format("DD-MM-YYYY"),r=this.creneauLivraison.hour.begin+" - "+this.creneauLivraison.hour.end;return{attributes:{localisation:this.location.current_address,recuperation:t,livraison:e,z_collecte_date:a,z_collecte_heure:s,z_livraison_date:i,z_livraison_heure:r}}},SaveAttributeCart(e){return new Promise(((t,a)=>{this.show_cover=!0,de.EC.post("/cart/update",e).then((e=>{this.show_cover=!1,t(e)})).catch((e=>{this.show_cover=!1,de.EC.isLocalDev?t(e):a()}))}))},saveOnExternalServer(e){return new Promise(((t,a)=>{de.EC.post("/shopify-api-rest/add-creneau-reserve",e.attributes,{params:{shop:window.ShopId}}).then((e=>{t(e)})).catch((e=>{a()}))}))},triggerCheckout(){document.querySelector(".creneaux-mbt .cart-checkout .submit-cart").click(),console.log("verfication de la presence du bouton formulaire ",document.querySelector(".creneaux-mbt .cart-checkout .submit-cart"))},deleteUpdateProduct(e,t=null){return new Promise(((a,s)=>{const i={updates:{}};this.show_cover=!0,i.updates[e]=0,de.EC.post("/cart/update",i).then((()=>{t?a(this.addProduct(t)):(this.show_cover=!1,a(!0))})).catch((()=>{this.show_cover=!1,s()}))}))}};de.EC.TestDomain="http://app-habeuk.kksa";var Ze={...Ae,async initcreneau(e){this.HideStaticLoading();const t=await this.loadcart();t&&(await this.getProductType(),this.TypeLivraison&&(this.CartTypeLivraison&&this.CartTypeLivraison.id&&this.CartTypeLivraison.id!==this.TypeLivraison.id?(e&&this.apply_type_livraison_by_id(this.CartTypeLivraison.id),await this.deleteUpdateProduct(this.CartTypeLivraison.id,this.TypeLivraison.id),await this.loadcart()):this.TypeLivraison&&!this.CartTypeLivraison.id&&await this.addDefaultProductTypeLivraison(),this.setEvant()))},HideStaticLoading(){},loadcart(){return new Promise(((e,t)=>{this.show_cover=!0,de.EC.get("/cart.js").then((t=>{console.log("Panier textStatus : ",t),this.show_cover=!1,this.cart=t.data,e(!0)})).catch((()=>{de.EC.isLocalDev?e(!1):t()}))}))},async getProductType(){if(!(this.cart&&this.cart.item_count>0))return!1;{const e=this.typeLivraisonIds();for(const t in this.cart.items){const a=this.cart.items[t];if(e.includes(a.id))return this.CartTypeLivraison=a,a}}},typeLivraisonIds(){const e=[];return this.creneauTypes.forEach((t=>{e.push(t.id)})),e},apply_type_livraison_by_id(e){for(const t in this.creneauTypes)e==this.creneauTypes[t].id&&te.Z.dispatch("SelectTypeTab",parseInt(t))},async addDefaultProductTypeLivraison(){await this.addProduct(this.TypeLivraison.id),await this.loadcart()},setEvant(){const e=document.querySelector(".btn.submit-cart-test");e.classList.add("d-inline-block"),e.addEventListener("click",(()=>{e.querySelector("i.fa-arrow-right").classList.add("d-none"),e.querySelector("i.fa-refresh").classList.remove("loadding"),e.querySelector("i.fa-refresh").classList.add("fa-spin"),this.SaveCreneau(e)})),document.addEventListener("SaveCreneauxChechout",(()=>{this.SaveCreneau()}))},async SaveCreneau(e=null){const t=await this.verification();if(t){const t=await this.buildAttribut();if(await this.SaveAttributeCart(t),this.saveOnExternalServer(t),await this.loadcart(),!(this.cart&&this.cart.attributes&&this.cart.attributes.livraison)&&this.app_env_prod)return e.classList.add("bg-danger"),this.show_alert=!0,this.alert_attribut_class="alert-danger ml-md-4",te.Z.state.alert_message+='- Une erreur s"est produite lors de la sauvegarde de vos informations. <br /> Verifier votre connexion et actualiser la page <br />',!1;e.querySelector("i.fa-arrow-right").classList.remove("d-none"),e.querySelector("i.fa-refresh").classList.add("loadding")}else e&&(e.classList.add("bg-danger"),e.querySelector("i.fa-refresh").classList.add("loadding"),console.log("store.state.alert_message : ",te.Z.state.alert_message))}},Oe={name:"App",components:{TabOption:M,InlineDescription:g,AppTitle:h,mapGoogle:R,creneau:He},props:{dateDuJour:{type:[String,Object,Date],required:!0}},data(){return{CreneauTypeProductId:null,initAuto:!0}},computed:{...(0,o.rn)(["creneauType","activeType","alert_message"]),appDateDisplay:{get(){return"livraison"===this.type&&this.creneauLivraison.date_string?se()(this.creneauLivraison.date_string,"YYYY-MM-DD").locale("fr").format("dddd Do MMMM"):"collecte"===this.type&&this.creneauCollecte.date_string?se()(this.creneauCollecte.date_string,"YYYY-MM-DD").locale("fr").format("dddd Do MMMM"):""}},currentCreneauType(){return this.initManageCart(this.creneauType[this.activeType]),this.creneauType[this.activeType]}},mounted(){const e=se()(this.dateDuJour,"DD-MM-YYYY HH:mm:ss");e._isValid&&this.$store.dispatch("SetDateDuJour",e)},methods:{async initManageCart(e){this.CreneauTypeProductId!==e.id&&(this.CreneauTypeProductId=e.id,Ze.TypeLivraison=e,await Ze.initcreneau(this.initAuto),this.initAuto=!1)}}},Ee=Oe,Be=(0,d.Z)(Ee,r,n,!1,null,null,null),je=Be.exports}}]);
//# sourceMappingURL=creneauxMylittlepressing.umd.min.148.js.map